/*!
    @author da宗熊
    @version 1.0.2
    @license ISC
    @lastModify 2019-12-19
    @repository https://github.com/linfenpan/collection/tree/master/plugins/swipe
    @example
        var swiper = new Swiper(element, options)
    @options
        [
          index[开始索引], ratio[每个子元素，占总宽度百分比 < 1], elastic[阻力大小 < 1],
          slideTime[滑动时间], resetTime[重置事件], nextDistance[到下一帧距离px或<1],
          interval[自动切换到下一帧的时间], repeat[是否循环], wrapSelector[wrap选择器],
          childSelector[子元素选择器], slideCallback[切换到下一帧的回调]
        ]
    @method
        swiper.resize(); // 当内容宽度、高度有所变化时，调用
        swiper.destroy(); // 销毁swiper
    @bug
        不会监听 "transitionEnd" 事件, 当页面嵌入在app的webview同时启动自动轮询时，因为visibilitychange事件不触发，所以动画会出现一瞬间的跳动。当然，不在webview内，一切正常得很~
*/
!function(t){function i(){}function e(t){return"string"==typeof t?document.querySelector(t):t}function n(t,i,e,n){var s=i.split(" ");s.forEach(function(i,s){t.addEventListener(i,e,n||!1)})}function s(t,i,e,n){var s=i.split(" ");s.forEach(function(i,s){t.removeEventListener(i,e,n||!1)})}function o(t,i){return t.hasOwnProperty(i)}function r(t){return[].slice.call(t,0)}function a(t,i){for(var e in t)o(t,e)&&i.call(t,t[e],e,t)}function h(t){return t in p||p.hasOwnProperty(t)?t:x+t.slice(0,1).toUpperCase()+t.slice(1)}function c(t,i){var e=t.style;a(i,function(t,i){e[h(i)]=t})}function d(t){var i=t.style[h("transform")];return i=i&&parseInt(i.match(/translateX\((.*?)\)/)[1])||0}function l(t,i,e){c(t,{transform:"translateX("+i+"px)",transitionDuration:(e||0)+"ms"})}function u(t,i){this.init(t,i)}var v=null,f=function(t,i){return t?t+i.replace(/^./,function(t){return t.toUpperCase()}):i},m="";!function(){for(var t=["webkit","moz","ms",""],i=0,e=t.length;i<e;i++)if(void 0!==document[f(t[i],"hidden")]){m=t[i];break}}();var p=document.documentElement.style,x=function(t){for(var i="",e=["webkitT","MozT","msT","oT","t"],n=0,s=e.length;n<s;n++){var o=e[n];if(t.hasOwnProperty(o+"ransform")){i=o.slice(0,-1);break}}return i}(p),g=function(){function i(t){return t=t.targetTouches&&t.targetTouches[0]||t.changedTouches&&t.changedTouches[0]||t,{x:t.pageX,y:t.pageY}}var o={},r=/mobile/i.test(t.navigator.userAgent),a={start:r?"touchstart":"mousedown",move:r?"touchmove":"mousemove",end:r?"touchend touchcancel":"mouseup mouseleave",needCatch:"click"};return o.hold=function(t){t=e(t);var o={start:v,end:v,onStart:v,onMove:v,onEnd:v},h={onStart:function(t){var e=o.start=i(t);e.spaceX=e.spaceY=0,o.end=v,o.onStart&&o.onStart(e,t)},onMove:function(t){if(o.start){var i=h.calcDiffAfterStart(t),e=!(o.onMove&&o.onMove(i,t));e&&t.preventDefault()}},onEnd:function(t){if(o.start){var i=o.end=h.calcDiffAfterStart(t);o.start=null,o.onEnd&&o.onEnd(i,t)}},onPrevent:function(t){var i=o.end||{};Math.abs(i.spaceX)>1&&(t.preventDefault(),t.stopPropagation())},calcDiffAfterStart:function(t){var e=i(t);return e.spaceX=e.x-o.start.x,e.spaceY=e.y-o.start.y,e}};return n(t,a.start,h.onStart),n(t,a.move,h.onMove),n(t,a.end,h.onEnd),!r&&n(t,a.needCatch,h.onPrevent,!0),o.destroy=function(){s(t,a.start,h.onStart),s(t,a.move,h.onMove),s(t,a.end,h.onEnd),!r&&s(t,a.needCatch,h.onPrevent,!0)},o},o}();u.prototype={$root:v,$wrap:v,$childs:v,$moves:v,$oldMoves:v,options:v,touchHolder:v,isNext:!1,isPrev:!1,isFirstMove:!1,isPreventMoving:!1,index:0,length:0,visibleCount:v,ratio:1,slideTime:300,resetTime:200,slideCallback:i,rootWidth:v,itemWidth:v,elastic:.3,oldNextDistance:v,nextDistance:.2,timer:v,interval:3e3,repeat:!0,wrapSelector:".swiper-wrap",childSelector:".swiper-item",init:function(t,n){this.$root=e(t),c(this.$root,{visibility:"visible"}),this.reset(n),this.setIndex(this.index),this.startTimer(),this.init=i;var s=this;s.fnPageshow=function(){document[f(m,"hidden")]||(s.stopTimer(),s.setIndex(s.index,!1),s.startTimer())}},reset:function(t){if(t=t||{},["index","ratio","elastic","slideTime","resetTime","nextDistance","interval","repeat","wrapSelector","childSelector","slideCallback"].forEach(function(i,e){o(t,i)&&(this[i]=t[i])}.bind(this)),this.ratio>1&&(this.ratio=1),this.rootWidth=this.$root.clientWidth,this.itemWidth=this.rootWidth*this.ratio,this.$wrap=this.$root.querySelector(this.wrapSelector),this.$childs=r(this.$root.querySelectorAll(this.childSelector)),this.length=this.$childs.length,this.$childs.forEach(function(t,i){t.dataset.index=i}),c(this.$wrap,{width:this.length*this.itemWidth+"px"}),this.ratio>=1)this.visibleCount=1;else{this.visibleCount=Math.floor(1/this.ratio);var i=(1-this.ratio*this.visibleCount)/2;this.visibleCount+=2*Math.ceil(i/this.ratio),this.visibleCount%2==0&&this.visibleCount++}this.oldNextDistance!=this.nextDistance&&(this.nextDistance=this.nextDistance<1?this.nextDistance*this.rootWidth:this.nextDistance,this.oldNextDistance==this.nextDistance),this.visibleCount+2>this.length&&(this.repeat=!1),!this.repeat&&(this.interval=0),this.placeChilds(),this.bindUI()},placeChilds:function(){var t=this.itemWidth;this.$childs.forEach(function(i,e){c(i,{width:t+"px"})})},bindUI:function(){this.touchHolder=g.hold(this.$wrap),this.bindHolder(),this.bindUI=i},bindHolder:function(){var t=this,i=t.touchHolder;i.onStart=function(i){return t.moveStart()},i.onMove=function(i){return t.moveIng(i)},i.onEnd=function(i){return t.moveEnd(i)}},moveStart:function(){var t=this;t.$moves.forEach(function(t){t.dataset.startx=d(t)}),t.isPreventMoving=!1,t.isFirstMove=!0,t.stopTimer()},moveIng:function(t){var i=this,e=t.spaceX,n=t.spaceY;if(i.isPreventMoving||i.isFirstMove&&Math.abs(e)<Math.abs(n))return i.isFirstMove=!1,i.isPreventMoving=!0;if(i.isFirstMove=!1,e*=.85,!i.repeat){var s=i.elastic,o=i.index;(o<=0&&e>0||o>=i.length-1&&e<0)&&(e*=s)}i.$moves.forEach(function(t){l(t,+t.dataset.startx+e,0)})},moveEnd:function(t){var i=this,e=t.spaceX;i.isPreventMoving||(Math.abs(e)>i.nextDistance?e>0?i.prev():i.next():i.$moves.forEach(function(t){l(t,+t.dataset.startx,i.resetTime)})),i.isPreventMoving=!1,i.startTimer()},next:function(t){t="undefined"==typeof t||t,this.setIndex(this.index+1,t)},prev:function(t){t="undefined"==typeof t||t,this.setIndex(this.index-1,t)},setIndex:function(t,i){var e=this;t==e.index?(e.isNext=!1,e.isPrev=!1):(e.isNext=t>e.index,e.isPrev=!e.isNext);var t=e.index=e.fixIndex(t);e.$oldMoves=e.$moves,e.$moves=[];var n=Math.max(Math.ceil(e.visibleCount/2),1);n<=0&&(n=1);for(var s=t-n,o=t+n;s<=o;)e.$moves.push(e.$childs[e.fixIndex(s)]),s++;e.placeVisibleChilds(i),e.slideCallback.call(e,t)},fixIndex:function(t){var i=this.repeat,e=this.length;if(i){for(;t<0;)t+=e;for(;t>=e;)t-=e;return t}return t<0?0:t>=e?e-1:t},placeVisibleChilds:function(t){var i=this,e=i.itemWidth,n=i.rootWidth;i.$oldMoves&&i.$oldMoves.forEach(function(t){var e=i.getChildOrignX(t.dataset.index);l(t,-e+1.2*n,0)});var s=i.$moves.length,o=Math.ceil(s/2)-1,r=e*s,a=-(r/2-i.rootWidth/2),h=i.$moves;h.forEach(function(n,r){var c,d=n.dataset.index;if(!i.repeat)if(r<o){if(h[r]==h[r+1])return}else if(r>o&&h[r]==h[r-1])return;c=i.isNext&&r==s-1||i.isPrev&&0==r?0:t?i.slideTime:0;var u=i.getChildOrignX(d);l(n,-u+a+e*r,c)})},getChildOrignX:function(t){return+t*this.itemWidth},resize:function(){this.reset(),this.$childs.forEach(function(t,i){l(t,-this.getChildOrignX(i)+1.2*this.rootWidth)}.bind(this)),this.setIndex(this.index)},startTimer:function(){this.interval&&(this.stopTimer(),this.timer=t.setTimeout(function(){this.next(),this.startTimer()}.bind(this),this.interval),document.addEventListener(m+"visibilitychange",this.fnPageshow,!1))},stopTimer:function(){this.interval&&(t.clearTimeout(this.timer),document.removeEventListener(m+"visibilitychange",this.fnPageshow,!1))},destroy:function(){this.stopTimer();var t=this.touchHolder;t&&t.destroy(),this.touchHolder=null}},t.Swiper=u}(window);